# AetherStitch GUI 翻译工具使用说明

## 概述

AetherStitch GUI 是一个简单易用的翻译工具，用于处理由 CLI 引擎提取的本地化 Mapping 文件。

## 功能特性

### 1. 加载和保存 Mapping 文件
- 点击"打开Mapping"按钮加载 JSON 格式的 Mapping 文件
- 修改翻译后，点击"保存"按钮保存更改
- 顶部工具栏显示实时统计信息（总计、已翻译、待翻译、进度百分比）

### 2. 翻译列表
- 左侧显示所有翻译项
- 每项显示：状态标记、类型、源文本、当前翻译
- 状态标记：
  - 🟢 绿色 = 已翻译
  - 🟠 橙色 = 待翻译

### 3. 过滤和搜索
- **筛选选项**：
  - 全部：显示所有翻译项
  - 待翻译：仅显示未翻译的项
  - 已翻译：仅显示已翻译的项
- **搜索框**：支持实时搜索源文本、翻译文本、Key

### 4. 翻译编辑
- 中间区域显示当前选中项的详细信息
- **源文本**：只读显示，不可修改
- **翻译文本框**：可编辑，支持多行文本
- 实时更新翻译状态
- **导航按钮**：
  - 上一个/下一个：快速浏览翻译项
- **状态标记按钮**：
  - ✓ 标记为已翻译：手动标记当前项为已完成状态（绿色）
  - ⏸ 标记为待翻译：手动标记当前项为待处理状态（橙色）
  - 用于跳过暂不翻译的项或标记已审核的翻译

### 4.5 批量操作（顶部工具栏）
- **标记无字母项**：
  - 自动将所有不包含字母的翻译项标记为已翻译
  - 适用于：纯数字、纯符号、空格、标点等
  - 示例：`123`、`45.67`、`!@#$`、`---` 等
  - 一键快速处理无需翻译的内容

- **正则匹配标记**：
  - 使用正则表达式批量标记匹配的翻译项
  - 提供常用预设模式（纯数字、URL、特定关键词等）
  - 支持自定义复杂匹配规则
  - 先预览匹配数量，确认后批量标记

### 5. 代码上下文查看（自动预览）
- 右侧显示字符串在代码中的使用位置
- **自动预览**：切换翻译项时自动显示第一个引用的代码预览
- **项目源码路径**：设置项目根目录以启用代码预览
- **使用位置列表**：显示所有引用此字符串的代码位置
  - 文件路径
  - 行号
  - 代码上下文
  - 点击任意位置自动刷新代码预览
- **代码预览**：
  - 自动显示第一个引用的代码片段
  - 点击其他位置可切换预览
  - 显示目标行及前后 5 行代码
  - 使用 `>>>` 标记目标行
- **在编辑器中打开**：点击 📝 按钮在默认编辑器中打开源文件

## 使用流程

### 步骤 1：运行 GUI
双击 `运行GUI.bat` 或在终端执行：
```bash
cd Gui
dotnet run
```

### 步骤 2：加载 Mapping 文件
1. 点击"打开Mapping"按钮
2. 选择之前用 CLI 提取的 mapping.json 文件
3. 等待加载完成

### 步骤 3：设置项目源码路径（可选）
1. 点击右侧"浏览..."按钮
2. 选择项目的 .csproj 文件
3. 这样可以启用代码预览功能

### 步骤 4：翻译
1. 在左侧列表选择待翻译项
2. 在中间区域的翻译文本框中输入翻译
3. 翻译会自动保存到内存
4. 使用筛选功能快速定位待翻译项
5. 使用状态标记按钮：
   - 点击 **"✓ 标记为已翻译"** 手动标记为完成（适用于审核通过的翻译）
   - 点击 **"⏸ 标记为待翻译"** 标记为待处理（适用于需要重新审核的翻译）

### 步骤 5：查看上下文（自动预览）
1. 选择翻译项后，右侧自动显示第一个引用的代码预览
2. 右侧显示该字符串的所有使用位置
3. 点击不同的使用位置切换代码预览
4. 根据代码上下文调整翻译

### 步骤 6：保存更改
1. 完成翻译后，点击"保存"按钮
2. 更改将写入原 Mapping 文件
3. 元数据和统计信息自动更新

## 快捷键

目前支持的导航：
- 点击翻译列表项切换翻译
- 使用"上一个"/"下一个"按钮浏览

## 翻译池模式

GUI 完全支持翻译池模式：
- 每个唯一字符串只翻译一次
- 一次翻译应用于所有使用位置
- 右侧显示该字符串的所有上下文引用

## 数据格式

### Mapping JSON 结构
```json
{
  "ProjectName": "项目名",
  "SourceLanguage": "en-US",
  "TargetLanguage": "zh-CN",
  "Translations": [
    {
      "Key": "唯一标识",
      "Source": "源文本",
      "Target": "翻译文本",
      "Type": 0,
      "Status": 0,
      "Contexts": [...]
    }
  ]
}
```

### 翻译状态
- `0` = Pending (待翻译)
- `1` = Translated (已翻译)

### 字符串类型
- `0` = Literal (字面量字符串)
- `1` = Interpolated (插值字符串)

## 常见问题

### Q: 为什么代码预览显示"请先设置项目源码路径"？
A: 需要在右侧点击"浏览..."按钮，选择项目的 .csproj 文件来设置源码路径。

### Q: 如何快速完成所有待翻译项？
A: 使用"待翻译"筛选，配合"下一个"按钮逐项翻译。

### Q: 修改了翻译，但忘记保存怎么办？
A: 关闭前会丢失未保存的更改。建议定期保存。

### Q: 可以同时打开多个 Mapping 文件吗？
A: 当前版本不支持，每次只能处理一个文件。

### Q: 什么时候使用"标记为已翻译"按钮？
A: 以下场景适用：
- 翻译文本与源文本相同时（如专有名词、品牌名）
- 已经审核确认的翻译
- 暂时跳过但想标记为完成的项

### Q: 切换翻译项时代码预览不显示？
A: 确保已设置项目源码路径，并且翻译项包含代码上下文引用。

### Q: 批量标记操作可以撤销吗？
A: 可以。批量标记后如果发现有误，可以：
- 使用"待翻译"筛选查看被标记的项
- 逐个点击"⏸ 标记为待翻译"撤销
- 或者重新加载原始mapping文件

### Q: 正则表达式不会写怎么办？
A: 正则对话框提供了8种常用预设模式，直接点击即可使用。常见场景都已覆盖。

### Q: "标记无字母项"会标记中文吗？
A: 不会。只有完全不包含任何字母（英文、中文、日文等）的字符串才会被标记，如纯数字、纯符号。

## 使用场景示例

### 场景 1：快速审核已有翻译
1. 加载 mapping.json
2. 使用"已翻译"筛选查看所有已翻译项
3. 逐项检查翻译质量
4. 如需修改，直接编辑翻译文本
5. 如需重新翻译，点击"⏸ 标记为待翻译"

### 场景 2：根据代码上下文翻译
1. 选择待翻译项
2. 右侧自动显示第一个引用的代码
3. 浏览所有使用位置，了解字符串在不同场景的用途
4. 根据上下文选择最合适的翻译
5. 完成后点击"下一个"

### 场景 3：专有名词处理
1. 对于不需要翻译的专有名词（如 "GitHub"）
2. 可以直接点击"✓ 标记为已翻译"
3. 即使 Target 为空或与 Source 相同，也能标记为完成
4. 节省时间，提高效率

### 场景 4：批量处理无需翻译的内容
1. 加载 mapping.json
2. 点击顶部工具栏的"标记无字母项"按钮
3. 系统自动标记所有纯数字、符号等无需翻译的内容
4. 确认对话框显示将标记的数量
5. 大幅减少需要手动处理的翻译项

### 场景 5：使用正则批量标记
1. 想要标记所有以数字开头的字符串
2. 点击"正则匹配标记"按钮
3. 在对话框中输入：`^\d`
   - 或选择预设模式："纯数字"、"URL格式"等
4. 系统预览匹配的数量（如：找到 50 个匹配项）
5. 确认后批量标记，节省大量时间

## 技术细节

- 基于 WPF (.NET 8.0)
- MVVM 架构
- 引用 Engine 项目的核心功能
- 支持实时数据绑定和命令模式
- 自动代码预览功能
- 状态标记系统

## 后续改进建议

- 添加撤销/重做功能
- 支持批量翻译
- 集成机器翻译 API
- 添加翻译历史记录
- 快捷键支持（Ctrl+S保存、方向键导航等）
- 深色主题
- 翻译记忆库功能
- 术语库管理
